# CVE-2016-7434 ntpd DOS exploit

Ntpd suffer from a null pointer reference which is possible to trigger to crash the application. According to NTP.org, "If ntpd is configured to allow mrulist query requests from a server that sends a crafted malicious packet, ntpd will crash on receipt of that crafted malicious mrulist query packet."

The ntpd program is an operating-system daemon that sets and maintains a computer system's system time in synchronization with Internet-standard time servers. It is a complete implementation of the Network Time Protocol (NTP) version 4, but retains compatibility with versions 1, 2, and 3. 

The routine that reads the MRU list (````read_mru_list```) can be found [here](https://github.com/opsxcq/exploit-CVE-2016-7434/blob/d0a66022701b38a76991ccf1816ce4ebfdb701ec/ntp-4.2.8p8/ntpd/ntp_control.c#L3952)

# Exploit

If you want a vulnerable system to test this exploit, you can use docker to create it

    docker run --rm -it --name ntpvulnerable -p 123:123/udp vulnerables/cve-2016-7434 

## python

    ./exploit.py -t <target ip> -p <target port>

## bash

    ./exploit.sh <target ip> <target port>

# Vulnerable versions

 * 4.3.90 
 * 4.3.25 
 * 4.3 
 * 4.3.93
 * 4.3.92
 * 4.3.77
 * 4.3.70
 * 4.2.8p8
 * 4.2.8p7
 * 4.2.8p6
 * 4.2.8p5
 * 4.2.8p4
 * 4.2.8p3
 * 4.2.8p2
 * 4.2.8p1
 * 4.2.7p22

# Not Vulnerable:

 * 4.3.94
 * 4.2.8p9

# Mitigation

 * Only allow mrulist query packets from trusted hosts.
 * Implement BCP-38.
 * Upgrade to 4.2.8p9.
 * Properly monitor your ntpd instances, and auto-restart ntpd (without -g) if it stops running.

### Disclaimer

This or previous program is for Educational purpose ONLY. Do not use it without permission. The usual disclaimer applies, especially the fact that me (opsxcq) is not liable for any damages caused by direct or indirect use of the information or functionality provided by these programs. The author or any Internet provider bears NO responsibility for content or misuse of these programs or any derivatives thereof. By using these programs you accept the fact that any damage (dataloss, system crash, system compromise, etc.) caused by the use of these programs is not opsxcq's responsibility.

# Credits

Magnus Klaaborg Stubman (@magnusstubman) found this flaw

